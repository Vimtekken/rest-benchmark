import Postgres from './postgres';
import { Sample } from './interfaces/Sample';

export default async function recordTestResult(configName: string, testName: string, subtestIndex: number, sample: Sample): Promise<void> {
	if (!sample.apache) {
		return;
	}
	await Postgres.connection.raw(`
	INSERT INTO test
	(
		config_name,
		test_name,
		sub_test_index,
		cpu_system_min,
		cpu_system_max,
		cpu_system_avg,
		cpu_user_min,
		cpu_user_max,
		cpu_user_avg,
		kernel_context_switches,
		kernel_context_switches_per_second,
		kernel_interrupts,
		kernel_processes_forked,
		memory_available_min,
		memory_available_max,
		memory_available_avg,
		memory_available_percent_min,
		memory_available_percent_max,
		memory_available_percent_avg,
		memory_free_min,
		memory_free_max,
		memory_free_avg,
		memory_used_min,
		memory_used_max,
		memory_used_avg,
		memory_used_percent_min,
		memory_used_percent_max,
		memory_used_percent_avg,
		connect_connect_min,
		connect_connect_mean,
		connect_connect_sd,
		connect_connect_median,
		connect_connect_max,
		connect_processing_min,
		connect_processing_mean,
		connect_processing_sd,
		connect_processing_median,
		connect_processing_max,
		connect_waiting_min,
		connect_waiting_mean,
		connect_waiting_sd,
		connect_waiting_median,
		connect_waiting_max,
		connect_total_min,
		connect_total_mean,
		connect_total_sd,
		connect_total_median,
		connect_total_max,
		data_total,
		data_transfer_rate,
		requests_completed,
		requests_duration,
		requests_failed,
		requests_non_2xx,
		requests_per_second,
		requests_time_per
	)
	VALUES
	(
		:config_name,
		:test_name,
		:sub_test_index,
		:cpu_system_min,
		:cpu_system_max,
		:cpu_system_avg,
		:cpu_user_min,
		:cpu_user_max,
		:cpu_user_avg,
		:kernel_context_switches,
		:kernel_context_switches_per_second,
		:kernel_interrupts,
		:kernel_processes_forked,
		:memory_available_min,
		:memory_available_max,
		:memory_available_avg,
		:memory_available_percent_min,
		:memory_available_percent_max,
		:memory_available_percent_avg,
		:memory_free_min,
		:memory_free_max,
		:memory_free_avg,
		:memory_used_min,
		:memory_used_max,
		:memory_used_avg,
		:memory_used_percent_min,
		:memory_used_percent_max,
		:memory_used_percent_avg,
		:connect_connect_min,
		:connect_connect_mean,
		:connect_connect_sd,
		:connect_connect_median,
		:connect_connect_max,
		:connect_processing_min,
		:connect_processing_mean,
		:connect_processing_sd,
		:connect_processing_median,
		:connect_processing_max,
		:connect_waiting_min,
		:connect_waiting_mean,
		:connect_waiting_sd,
		:connect_waiting_median,
		:connect_waiting_max,
		:connect_total_min,
		:connect_total_mean,
		:connect_total_sd,
		:connect_total_median,
		:connect_total_max,
		:data_total,
		:data_transfer_rate,
		:requests_completed,
		:requests_duration,
		:requests_failed,
		:requests_non_2xx,
		:requests_per_second,
		:requests_time_per
	);`, {
		config_name: configName,
		test_name: testName,
		sub_test_index: subtestIndex,
		cpu_system_min: sample.system.cpu.system.min,
		cpu_system_max: sample.system.cpu.system.max,
		cpu_system_avg: sample.system.cpu.system.average,
		cpu_user_min: sample.system.cpu.user.min,
		cpu_user_max: sample.system.cpu.user.max,
		cpu_user_avg: sample.system.cpu.user.average,
		kernel_context_switches: sample.system.kernel.contextSwitches,
		kernel_context_switches_per_second: sample.system.kernel.contextSwitchesPerSecond,
		kernel_interrupts: sample.system.kernel.interrupts,
		kernel_processes_forked: sample.system.kernel.processesForked,
		memory_available_min: sample.system.memory.available.min,
		memory_available_max: sample.system.memory.available.max,
		memory_available_avg: sample.system.memory.available.average,
		memory_available_percent_min: sample.system.memory.availablePercent.min,
		memory_available_percent_max: sample.system.memory.availablePercent.max,
		memory_available_percent_avg: sample.system.memory.availablePercent.average,
		memory_free_min: sample.system.memory.free.min,
		memory_free_max: sample.system.memory.free.max,
		memory_free_avg: sample.system.memory.free.average,
		memory_used_min: sample.system.memory.used.min,
		memory_used_max: sample.system.memory.used.max,
		memory_used_avg: sample.system.memory.used.average,
		memory_used_percent_min: sample.system.memory.usedPercent.min,
		memory_used_percent_max: sample.system.memory.usedPercent.max,
		memory_used_percent_avg: sample.system.memory.usedPercent.average,
		connect_connect_min: sample.apache.connect.connect.min,
		connect_connect_mean: sample.apache.connect.connect.mean,
		connect_connect_sd: sample.apache.connect.connect.sd,
		connect_connect_median: sample.apache.connect.connect.median,
		connect_connect_max: sample.apache.connect.connect.max,
		connect_processing_min: sample.apache.connect.processing.min,
		connect_processing_mean: sample.apache.connect.processing.mean,
		connect_processing_sd: sample.apache.connect.processing.sd,
		connect_processing_median: sample.apache.connect.processing.median,
		connect_processing_max: sample.apache.connect.processing.max,
		connect_waiting_min: sample.apache.connect.waiting.min,
		connect_waiting_mean: sample.apache.connect.waiting.mean,
		connect_waiting_sd: sample.apache.connect.waiting.sd,
		connect_waiting_median: sample.apache.connect.waiting.median,
		connect_waiting_max: sample.apache.connect.waiting.max,
		connect_total_min: sample.apache.connect.total.min,
		connect_total_mean: sample.apache.connect.total.mean,
		connect_total_sd: sample.apache.connect.total.sd,
		connect_total_median: sample.apache.connect.total.median,
		connect_total_max: sample.apache.connect.total.max,
		data_total: sample.apache.data.totalTransferred,
		data_transfer_rate: sample.apache.data.transferRate,
		requests_completed: sample.apache.requests.completed,
		requests_duration: sample.apache.requests.duration,
		requests_failed: sample.apache.requests.failed,
		requests_non_2xx: sample.apache.requests.non2xx,
		requests_per_second: sample.apache.requests.rps,
		requests_time_per: sample.apache.requests.timePerRequest,
	});
}
